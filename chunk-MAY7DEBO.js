import{a as be}from"./chunk-GOSNS7PG.js";import{a as oe,b as C,c as M,d as le,e as me,f as x,g as ce,h as de,i as pe,j as ue,k as N,l as V,m as $,n as ge,o as ke}from"./chunk-YDCFJKCP.js";import{a as S}from"./chunk-YK4R6DJK.js";import{a as re}from"./chunk-YVELGN4G.js";import{a as ae}from"./chunk-B4TRIBHJ.js";import{$ as te,C as X,E as l,J as b,K as m,L as R,M as Y,N as s,O as i,P as h,Q as v,R as p,S as k,T as A,U as H,V as G,W as r,X as f,Y as T,Z,_ as ee,a as q,b as W,ba as y,ca as F,da as B,ea as Q,g as L,j as _,la as P,ma as U,na as I,o as J,oa as ie,pa as O,qa as se,ra as z,s as d,sa as ne,t as E,w as K,x as u,y as g}from"./chunk-6PQSHQPV.js";var w=class a{toast=d(S);http=d(ne);url=`${re.apiUrl}tasks/`;tasksSubject=new L([]);tasks$=this.tasksSubject.asObservable();totalPagesSubject=new L(1);totalPages$=this.totalPagesSubject.asObservable();platformId=d(X);currentPage=1;limit=10;getHeaders(){return se(this.platformId)?new z({Authorization:"Bearer "+window.localStorage.getItem("accessToken")}):new z({Authorization:"Bearer "})}getTasks(t=1,e=""){let n=`${this.url}getTasks?page=${t}&limit=${this.limit}`;e&&(n+=`&status=${e}`),this.http.get(n,{headers:this.getHeaders()}).pipe(_(o=>(this.totalPagesSubject.next(o.totalPages),o.data))).subscribe(o=>{this.tasksSubject.next(o),this.toast.closeModalLoading()})}updateTask(t,e){return this.http.put(`${this.url}updateTask/${t}`,e,{headers:this.getHeaders()}).pipe(_(n=>(this.getTasks(this.currentPage),n)))}changeTaskStatus(t,e){return this.http.put(`${this.url}changeTaskStatus/${t}`,e,{headers:this.getHeaders()}).pipe(_(n=>(this.getTasks(this.currentPage),n)))}deleteTask(t){return this.http.delete(`${this.url}deleteTask/${t.id}`,{headers:this.getHeaders()}).pipe(_(e=>(this.getTasks(this.currentPage),e)))}getCurrentPage(){return this.currentPage}createTask(t){return this.http.post(`${this.url}createTask`,t,{headers:this.getHeaders()}).pipe(_(e=>(this.getTasks(this.currentPage),e)))}setCurrentPage(t){this.currentPage=t,this.getTasks(t)}static \u0275fac=function(e){return new(e||a)};static \u0275prov=J({token:a,factory:a.\u0275fac,providedIn:"root"})};var Se=(a,t)=>({"btn-danger":a,"btn-primary":t});function Ce(a,t){a&1&&(s(0,"div",16),r(1," El t\xEDtulo es obligatorio (m\xEDnimo 3 caracteres). "),i())}function xe(a,t){if(a&1){let e=v();s(0,"li",20)(1,"div",21)(2,"button",22),p("click",function(){let o=u(e).$implicit,c=k(2);return g(c.toggleUserSelection(o))}),r(3),i(),s(4,"div",23)(5,"span",24),r(6),i(),s(7,"span",25),r(8),i()()()()}if(a&2){let e=t.$implicit,n=k(2);l(2),m("ngClass",F(4,Se,n.isSelected(e),!n.isSelected(e))),l(),T(" ",n.isSelected(e)?"Quitar":"Agregar"," "),l(3),f(e.name),l(2),f(e.email)}}function we(a,t){if(a&1&&(s(0,"div",17)(1,"ul",18),b(2,xe,9,7,"li",19),i()()),a&2){let e=k();l(2),m("ngForOf",e.users)}}function Fe(a,t){if(a&1){let e=v();s(0,"li")(1,"span",27),p("click",function(){let o=u(e).$implicit,c=k(2);return g(c.removeUser(o))}),r(2,"\u274C"),i(),r(3),i()}if(a&2){let e=t.$implicit;l(3),T(" ",e.name," ")}}function Ee(a,t){if(a&1&&(s(0,"div")(1,"strong"),r(2,"Usuarios seleccionados:"),i(),s(3,"ul"),b(4,Fe,4,1,"li",26),i()()),a&2){let e=k();l(4),m("ngForOf",e.selectedUsers)}}function ye(a,t){a&1&&r(0,"Editar")}function Pe(a,t){a&1&&r(0,"Crear")}var D=class a{userLocalService=d(ae);usersService=d(be);taskService=d(w);toast=d(S);task=null;userSubscription=null;currentUser=null;selectedUsers=[];users=[];taskForm=new me({title:new x("",[C.required,C.minLength(3)]),status:new x("pending",C.required),description:new x("",C.maxLength(500)),owners:new x([],C.required),searchTerm:new x("")});ngOnInit(){this.userSubscription=this.userLocalService.user$.subscribe(t=>{this.currentUser=t,this.ensureCurrentUserInOwners()})}ngOnChanges(t){t.task&&this.task&&(this.taskForm.patchValue(this.task),this.selectedUsers=this.task.owners.filter(e=>e.idUser!==this.currentUser?.idUser),this.ensureCurrentUserInOwners())}ensureCurrentUserInOwners(){if(this.currentUser?.idUser){let t=this.taskForm.get("owners")?.value||[];t.includes(this.currentUser.idUser)||this.taskForm.patchValue({owners:[this.currentUser.idUser,...t]})}}searchUsers(){if(this.taskForm.get("searchTerm")?.value.trim()===""){this.users=[];return}this.usersService.searchUsers(this.taskForm.get("searchTerm")?.value).subscribe(t=>{this.users=t.message.filter(e=>e.idUser!==this.currentUser?.idUser)})}toggleUserSelection(t){this.isSelected(t)?this.selectedUsers=this.selectedUsers.filter(e=>e.idUser!==t.idUser):this.selectedUsers.push(t),this.updateOwners()}removeUser(t){t.idUser!==this.currentUser?.idUser&&(this.selectedUsers=this.selectedUsers.filter(e=>e.idUser!==t.idUser)),this.updateOwners()}updateOwners(){this.currentUser?.idUser&&this.taskForm.patchValue({owners:[this.currentUser.idUser,...this.selectedUsers.map(t=>t.idUser)]})}isSelected(t){return this.selectedUsers.some(e=>e.idUser===t.idUser)}saveTask(){if(this.taskForm.invalid){this.toast.setToastPopup("Por favor, completa correctamente los campos.","error");return}let t=W(q({},this.taskForm.value),{owners:[this.currentUser?.idUser,...this.selectedUsers.map(e=>e.idUser)]});this.task?this.taskService.updateTask(this.task.id,t).subscribe(()=>{this.toast.setToastPopup("Tarea actualizada correctamente.","success"),this.resetForm()}):this.taskService.createTask(t).subscribe(()=>{this.toast.setToastPopup("Tarea creada correctamente.","success"),this.resetForm()})}resetForm(){this.selectedUsers=[],this.users=[],this.taskForm.reset({owners:[this.currentUser?.idUser],status:"pending",description:"",searchTerm:"",title:""})}ngOnDestroy(){this.userSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=E({type:a,selectors:[["app-task-form"]],inputs:{task:"task"},standalone:!0,features:[K,y],decls:29,vars:6,consts:[[3,"formGroup"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","formControlName","title","placeholder","Ingresa un t\xEDtulo",1,"form-control"],["class","text-danger",4,"ngIf"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","3","placeholder","Ingresa una descripci\xF3n (opcional)",1,"form-control"],[1,"form-label"],["formControlName","status",1,"form-select"],["value","pending"],["value","completed"],["type","text","placeholder","Buscar usuarios por nombre o correo...","formControlName","searchTerm",1,"form-control",3,"input"],["class","scroll-box user-list",4,"ngIf"],[4,"ngIf"],[1,"text-center"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],[1,"text-danger"],[1,"scroll-box","user-list"],[1,"list-group","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-sm",2,"width","auto",3,"click","ngClass"],[1,"d-flex","flex-column"],[1,"fw-bold"],[1,"text-muted","small"],[4,"ngFor","ngForOf"],[2,"cursor","pointer",3,"click"]],template:function(e,n){if(e&1&&(s(0,"form",0)(1,"div",1)(2,"label",2),r(3,"T\xEDtulo"),i(),h(4,"input",3),b(5,Ce,2,0,"div",4),i(),s(6,"div",1)(7,"label",5),r(8,"Descripci\xF3n"),i(),h(9,"textarea",6),i(),s(10,"div",1)(11,"label",7),r(12,"Estado"),i(),s(13,"select",8)(14,"option",9),r(15,"Pendiente"),i(),s(16,"option",10),r(17,"Completada"),i()()(),s(18,"div",1)(19,"label",7),r(20,"Compartir con usuarios"),i(),s(21,"input",11),p("input",function(){return n.searchUsers()}),i()(),b(22,we,3,1,"div",12)(23,Ee,5,1,"div",13),s(24,"div",14)(25,"button",15),p("click",function(){return n.saveTask()}),b(26,ye,1,0)(27,Pe,1,0),r(28," tarea "),i()()()),e&2){let o;m("formGroup",n.taskForm),l(5),m("ngIf",((o=n.taskForm.get("title"))==null?null:o.invalid)&&((o=n.taskForm.get("title"))==null?null:o.touched)),l(17),m("ngIf",n.users.length>0),l(),m("ngIf",n.selectedUsers.length>0),l(2),m("disabled",n.taskForm.invalid),l(),Y(n.task?26:27)}},dependencies:[O,P,U,I,ke,de,V,$,oe,N,M,le,pe,ue],styles:[".container[_ngcontent-%COMP%]{max-width:500px;background:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 6px #0000001a}h2[_ngcontent-%COMP%]{margin-bottom:20px}button[_ngcontent-%COMP%]{width:100%}"]})};var Ue=["editTaskModal"],Ie=["taskFormComponent"],Oe=(a,t)=>({"bg-success":a,"bg-warning":t}),Me=(a,t)=>({"btn-success":a,"btn-warning":t});function Ne(a,t){if(a&1){let e=v();s(0,"tr")(1,"td"),r(2),i(),s(3,"td")(4,"span",32),r(5),i()(),s(6,"td"),r(7),i(),s(8,"td"),r(9),i(),s(10,"td")(11,"button",33),p("click",function(){let o=u(e).$implicit,c=k(2);return g(c.changeTaskStatus(o))}),r(12),i()(),s(13,"td")(14,"div",34)(15,"button",35),p("click",function(){let o=u(e).$implicit,c=k(2);return g(c.openEditModal(o))}),r(16," \u270F\uFE0F "),i(),s(17,"button",36),p("click",function(){let o=u(e).$implicit,c=k(2);return g(c.deleteTask(o))}),r(18,"\u274C"),i()()()()}if(a&2){let e=t.$implicit,n=t.index,o=k(2);l(2),f((o.currentPage-1)*o.pageSize+n+1),l(2),m("ngClass",F(7,Oe,e.status==="completed",e.status==="pending")),l(),T(" ",e.status==="completed"?"Completado":"Pendiente"," "),l(2),f(e.title),l(2),f(e.description),l(2),m("ngClass",F(10,Me,e.status==="pending",e.status==="completed")),l(),T(" ",e.status==="pending"?"Completar":"Pendiente"," ")}}function Ve(a,t){if(a&1&&(s(0,"tbody"),b(1,Ne,19,13,"tr",31),i()),a&2){let e=t.ngIf;l(),m("ngForOf",e)}}var fe=class a{editTaskModal;taskFormComponent;taskService=d(w);toast=d(S);totalPages$=this.taskService.totalPages$;tasks$=this.taskService.tasks$;currentPage=1;pageSize=10;selectedTask=null;selectedStatus="";ngOnInit(){this.getTasks()}changePage(t){this.currentPage=t,this.getTasks()}getTasks(){this.toast.showModalLoading(),this.taskService.getTasks(this.currentPage,this.selectedStatus)}filterTasks(){this.currentPage=1,this.getTasks()}openEditModal(t){this.selectedTask=t}closeModal(){this.selectedTask=null,this.taskFormComponent.resetForm()}deleteTask(t){this.toast.showModalConfirm("\xBFEst\xE1s seguro de eliminar esta tarea?",e=>{e.isConfirmed&&this.taskService.deleteTask(t).subscribe(()=>{this.toast.setToastPopup("Tarea eliminada correctamente.","success"),this.getTasks()})})}changeTaskStatus(t){let e=t.status==="pending"?"completed":"pending";this.taskService.changeTaskStatus(t.id,{status:e}).subscribe(()=>{this.toast.setToastPopup(`Tarea marcada como ${e==="completed"?"completada":"pendiente"}.`,"success"),this.getTasks()})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=E({type:a,selectors:[["app-tasks"]],viewQuery:function(e,n){if(e&1&&(A(Ue,5),A(Ie,5)),e&2){let o;H(o=G())&&(n.editTaskModal=o.first),H(o=G())&&(n.taskFormComponent=o.first)}},standalone:!0,features:[y],decls:65,vars:12,consts:[["taskFormComponent",""],[1,"container","mt-4"],[1,"mb-3","text-center"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"d-flex","align-items-center"],["for","statusFilter",1,"me-2"],["id","statusFilter",1,"form-select","w-auto",3,"ngModelChange","change","ngModel"],["value",""],["value","pending"],["value","completed"],["data-bs-toggle","modal","data-bs-target","#taskModal",1,"btn","btn-primary"],[1,"table-responsive"],[1,"table","table-striped","table-bordered"],[1,"table-dark"],[4,"ngIf"],[1,"mt-3"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-link"],["id","taskModal","tabindex","-1","aria-labelledby","taskModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","taskModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","editTaskModal","tabindex","-1","aria-labelledby","editTaskModalLabel","aria-hidden","true",1,"modal","fade"],["id","editTaskModalLabel",1,"modal-title"],[3,"task"],[4,"ngFor","ngForOf"],[1,"badge",3,"ngClass"],[1,"btn","btn-sm",3,"click","ngClass"],[1,"d-flex","justify-content-center","align-items-center"],["data-bs-toggle","modal","data-bs-target","#editTaskModal",1,"btn","btn-sm","btn","btn-outline-warning","me-2",3,"click"],[1,"btn","btn-sm","btn","btn-outline-danger","me-2",3,"click"]],template:function(e,n){if(e&1){let o=v();s(0,"div",1)(1,"h2",2),r(2,"Listado de tareas"),i(),s(3,"div",3)(4,"div",4)(5,"label",5),r(6,"Filtrar por estado:"),i(),s(7,"select",6),te("ngModelChange",function(j){return u(o),ee(n.selectedStatus,j)||(n.selectedStatus=j),g(j)}),p("change",function(){return u(o),g(n.filterTasks())}),s(8,"option",7),r(9,"Todos"),i(),s(10,"option",8),r(11,"Pendiente"),i(),s(12,"option",9),r(13,"Completado"),i()()(),s(14,"button",10),r(15,"+ Nueva Tarea"),i()(),s(16,"div",11)(17,"table",12)(18,"thead",13)(19,"tr")(20,"th"),r(21,"#"),i(),s(22,"th"),r(23,"Estado"),i(),s(24,"th"),r(25,"T\xEDtulo"),i(),s(26,"th"),r(27,"Descripci\xF3n"),i(),s(28,"th"),r(29,"Cambiar estado"),i(),s(30,"th"),r(31,"Acciones"),i()()(),b(32,Ve,2,1,"tbody",14),B(33,"async"),i()(),s(34,"nav",15)(35,"ul",16)(36,"li",17)(37,"button",18),p("click",function(){return u(o),g(n.changePage(n.currentPage-1))}),r(38,"Anterior"),i()(),s(39,"li",19)(40,"span",20),r(41),i()(),s(42,"li",17),B(43,"async"),s(44,"button",18),p("click",function(){return u(o),g(n.changePage(n.currentPage+1))}),r(45,"Siguiente"),i()()()()(),s(46,"div",21)(47,"div",22)(48,"div",23)(49,"div",24)(50,"h5",25),r(51,"Crear nueva tarea"),i(),h(52,"button",26),i(),s(53,"div",27),h(54,"app-task-form"),i()()()(),s(55,"div",28)(56,"div",22)(57,"div",23)(58,"div",24)(59,"h5",29),r(60,"Editar tarea"),i(),h(61,"button",26),i(),s(62,"div",27),h(63,"app-task-form",30,0),i()()()()}e&2&&(l(7),Z("ngModel",n.selectedStatus),l(25),m("ngIf",Q(33,8,n.tasks$)),l(4),R("disabled",n.currentPage===1),l(5),T("P\xE1gina ",n.currentPage,""),l(),R("disabled",Q(43,10,n.totalPages$)===n.currentPage),l(21),m("task",n.selectedTask))},dependencies:[O,P,U,I,ie,D,ge,V,$,N,M,ce],styles:[".container[_ngcontent-%COMP%]{max-width:800px}.table[_ngcontent-%COMP%]{text-align:center}.badge[_ngcontent-%COMP%]{font-size:1rem;padding:5px 10px}"]})};export{fe as TasksComponent};
